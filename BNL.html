<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Truck Optimization App</title>
<meta name="robots" content="noindex, nofollow">
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCFoZNk73X4CY1RG3xghjxbAPTnx0JXmO8"></script>
<style>
body{font-family:Arial,sans-serif;margin:10px}h2{margin-top:20px}#fileUpload{border:2px dashed #666;padding:20px;text-align:center;cursor:pointer;margin-bottom:10px}#solutionContainer{display:flex;flex-direction:column;gap:20px}.solution{border:1px solid #ccc;padding:10px}.truckCard{border:1px solid #888;margin-bottom:10px;padding:10px}.map{width:100%;height:300px}.metrics{margin-top:5px;background:#f5f5f5;padding:5px;font-size:14px}.warnings{color:red;font-weight:bold}button{margin:5px 0}select{margin-left:10px}
</style>
</head>
<body>
<h1>Truck Optimization App</h1>
<div id="fileUpload">Drag & Drop Excel File Here</div>
<label>Assignment Algorithm:
<select id="algorithmSelector">
<option value="B">B - Clustering</option>
<option value="C" selected>C - Hybrid</option>
</select>
</label>
<button id="calculateBtn">Calculate Solutions</button>
<button id="regenerateBtn">Regenerate Alternatives</button>
<h2>Alternative Solutions</h2>
<div id="solutionContainer"></div>
<script>
const clientAddresses={"SHI001":"Dordrecht Voltastraat 6A","SHI038":"Dordrecht Voltastraat 6A","FUJ001":"ROTTERDAM Kortenoord 2-8","FUJ118":"ROTTERDAM Kortenoord 2-8","FUJWEB":"ROTTERDAM Kortenoord 2-8","ARN001":"Rotterdam Plompertstraat 18B","RMS001":"Rotterdam Plompertstraat 50","RMS118":"Rotterdam Plompertstraat 50","GEO003":"ROTTERDAM van Maasdijkweg 56","GEO118":"ROTTERDAM van Maasdijkweg 56","EMD001":"Van Maasdijkweg 56, 3088 EG Rotterdam","VIV118":"Rotterdam Gieterijweg 17","MAA002":"HOOGVLIET Klompenmakerstraat 26","MAA118":"HOOGVLIET Klompenmakerstraat 26","MAA120":"HOOGVLIET Klompenmakerstraat 26","MAA119":"HOOGVLIET Klompenmakerstraat 26","MAR118":"HOOGVLIET Tinnegieterstraat 15","MPA001":"HOOGVLIET Tinnegieterstraat 15","MAS005":"SCHIEDAM ’s-Gravelandseweg 359","NOV001":"Rotterdam Nova Ship, Lodewijk Picoffsweg 438","OUW001":"PERNIS Tarwezand 2-20","OUWWEB":"PERNIS Tarwezand 2-20","MSC001":"ROTTERDAM Columbusstraat 26-28","NEK001":"Rotterdam Columbusstraat 22-26","NEK118":"Rotterdam Columbusstraat 22-26","NEK002":"Rotterdam Columbusstraat 22-26","NEK003":"Rotterdam Columbusstraat 22-26","INT025":"Rotterdam Columsstraat 30a","SUP002":"Rotterdam Columbusstraat 12","SUP118":"Rotterdam Columbusstraat 12","WRI001":"ROTTERDAM Bunschotenweg 58","WRI04B":"ROTTERDAM Bunschotenweg 58","WRI007":"ROTTERDAM Bunschotenweg 58","WRKL00":"ROTTERDAM Bunschotenweg 58","WRKL18":"ROTTERDAM Bunschotenweg 58","VAN008":"Rotterdam Bunschotenweg 115","TER118":"Vierpolders","TER001":"Vierpolders","KLO118":"Rotterdam Rhoneweg 68","KLO119":"Rotterdam Rhoneweg 68","PEN001":"RHOON Kleidijk 88","SCH018":"ALBLASSERDAM Van Hennaertweg 1","ROT003":"Barendrecht Transportweg 20","MEE002":"Barendrecht Donk 15","MEE118":"Barendrecht Donk 15","DIT002":"BARENDRECHT Bijdorp-Oost 14A","MOS002":"Barendrecht FENNAWEG 24","HAR004":"BARENDRECHT Achterzeedijk 57","HAR118":"BARENDRECHT Achterzeedijk 57","GIL001":"ROTTERDAM Giessenweg 56","GIL118":"ROTTERDAM Giessenweg 56","ADR002":"SCHIEDAM Admiraal de Ruyterstraat 16C","POS001":"Rotterdam Pittsburgstraat 33","PRI006":"SCHIEDAM Fokkerstraat 517","VER011":"BERGSCHENHOEK Frans Halslaan 4","GIM001":"Schiedam Jan Van Galenstraat 9","GIM118":"Schiedam Jan Van Galenstraat 9","LIM001":"Strickledeweg 25, 3125 AT Schiedam","IST001":"VLAARDINGEN Kotterstraat 2","BRA001":"Rotterdam Columbusstraat 22-26","BRA004":"Rotterdam Columbusstraat 22-26","SEA013":"VLAARDINGEN Hoekerstraat 19","KOO004":"VLISSINGEN KoolwijkShipstoresWesterhavenweg 14","ROS002":"Rhoneweg 68, 3198 LE Europoort Rotterdam","KOO119":"MIDDELBURG Grenadierweg 19","PRO006":"ZWIJNDRECHT Westpoort 51/59","PRO131":"ZWIJNDRECHT Westpoort 51/59","HUL001":"ANTWERPEN Bredastraat 139","DEL007":"ZWIJNDRECHT Westpoort 51-59","ELE001":"Spijkenisse Ohmweg 14","ELEWEB":"Spijkenisse Ohmweg 14","FMVB01":"SPIJKENISSE Curieweg 2","FMVB02":"SPIJKENISSE Curieweg 2"};
let orders=[],solutions=[],selectedSolutionIndex=0;
const START_POINT="Snelliusstraat 12, Dordrecht";
const fileUpload=document.getElementById("fileUpload");
fileUpload.addEventListener("dragover",e=>e.preventDefault());
fileUpload.addEventListener("drop",handleFile);
function handleFile(e){e.preventDefault();const file=e.dataTransfer.files[0];if(!file)return;const reader=new FileReader();reader.onload=function(evt){const data=new Uint8Array(evt.target.result);const workbook=XLSX.read(data,{type:"array"});const firstSheet=workbook.Sheets[workbook.SheetNames[0]];let jsonData=XLSX.utils.sheet_to_json(firstSheet,{raw:false,defval:""});jsonData=jsonData.map(row=>{let newRow={};for(let key in row)newRow[key.trim()]=row[key];return newRow});parseOrders(jsonData)};reader.readAsArrayBuffer(file)}
function parseOrders(data){orders=data.map(row=>{let transportNumber=row["Transport no."]?row["Transport no."].toString().split(/-|,/)[0]:"";let customerCode=row["Customer"];let address=clientAddresses[customerCode]||"";let m3=parseFloat((row["Expected mtr3"]||"0").toString().replace(",", "."))||0;return{transportNumber,m3,customerCode,address,warehouse:row["Warehouse(s)"]||"",assignedTruck:null,displayWarning:row["Warehouse(s)"]==="CSD"}});alert(`Imported ${orders.length} orders.`)}
document.getElementById("calculateBtn").addEventListener("click",()=>{if(orders.length===0)return alert("No orders loaded!");calculateSolutions()});
document.getElementById("regenerateBtn").addEventListener("click",()=>{if(orders.length===0)return alert("No orders loaded!");calculateSolutions()});
function calculateSolutions(){const algo=document.getElementById("algorithmSelector").value;solutions=[];for(let alt=0;alt<3;alt++){let trucks=[[],[],[]];if(algo==="C"){const sorted=[...orders].sort((a,b)=>b.m3-a.m3);sorted.forEach((o,idx)=>{let truckIdx=[0,1,2].reduce((prev,i)=>{let sum=(trucks[i].reduce((a,b)=>a+b.m3,0));return sum<=(trucks[prev].reduce((a,b)=>a+b.m3,0))?i:prev;},0);trucks[truckIdx].push(o);o.assignedTruck=truckIdx+1})}else{const shuffled=[...orders].sort(()=>Math.random()-0.5);shuffled.forEach((o,idx)=>{const truckIndex=idx%3;o.assignedTruck=truckIndex+1;trucks[truckIndex].push(o)})}const trucksData=trucks.map((truckOrders,i)=>{const stopsMap={};truckOrders.forEach(o=>{stopsMap[o.address]=(stopsMap[o.address]||[]);stopsMap[o.address].push(o)});const stops=Object.keys(stopsMap).map(address=>({address,orders:stopsMap[address],totalM3:stopsMap[address].reduce((a,b)=>a+b.m3,0),hasCSD:stopsMap[address].some(o=>o.displayWarning)}));return{truckId:i+1,orders:truckOrders,stops,totalM3:truckOrders.reduce((a,b)=>a+b.m3,0),totalDistance:0,totalTime:0,warnings:truckOrders.some(o=>o.displayWarning)?["CSD present"]:[]}});solutions.push({trucks:trucksData})}selectedSolutionIndex=0;renderSolutions()}
function renderSolutions(){const container=document.getElementById("solutionContainer");container.innerHTML="";solutions.forEach((solution,sIdx)=>{const solutionDiv=document.createElement("div");solutionDiv.className="solution";solution.trucks.forEach(truck=>{const truckDiv=document.createElement("div");truckDiv.className="truckCard";let html=`<h3>Truck ${truck.truckId}</h3><div class="metrics">Total m³: ${truck.totalM3.toFixed(2)}<br>Stops: ${truck.stops.length}<br><span class="warnings">${truck.warnings.join(", ")}</span></div><button onclick="exportTruck(${sIdx},${truck.truckId})">Export Truck ${truck.truckId}</button>`;truckDiv.innerHTML=html;solutionDiv.appendChild(truckDiv);if(typeof google!=="undefined"&&google.maps){const mapDiv=document.createElement("div");mapDiv.id=`map-${sIdx}-${truck.truckId}`;mapDiv.className="map";truckDiv.appendChild(mapDiv);const map=new google.maps.Map(mapDiv,{zoom:10,center:{lat:51.8225,lng:4.667}});const directionsService=new google.maps.DirectionsService();const directionsRenderer=new google.maps.DirectionsRenderer({map:map,suppressMarkers:false});const waypoints=truck.stops.map(stop=>({location:stop.address,stopover:true}));if(waypoints.length>0){directionsService.route({origin:START_POINT,destination:START_POINT,waypoints,optimizeWaypoints:true,travelMode:'DRIVING'},(response,status)=>{if(status==='OK')directionsRenderer.setDirections(response)})}}});container.appendChild(solutionDiv)})}
function exportTruck(solutionIdx,truckId){const truck=solutions[solutionIdx].trucks.find(t=>t.truckId===truckId);const transportNumbers=truck.orders.map(o=>o.transportNumber).join(";");const blob=new Blob([transportNumbers],{type:"text/plain"});const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download=`truck${truckId}_solution${solutionIdx+1}.txt`;a.click();URL.revokeObjectURL(url)}
</script>
</body>
</html>
