<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Truck Load Optimizer</title>

<style>
:root { --primary:#2563eb; --bg:#f8fafc; --card:#fff; --border:#e2e8f0; --text:#1e293b; }
body { font-family: system-ui, sans-serif; background: var(--bg); color: var(--text); padding:2rem; max-width:1200px; margin:auto; }
h1 { color:var(--primary); }
.subtitle { color:#64748b; margin-bottom:1.5rem; }

.container { display:grid; grid-template-columns:360px 1fr; gap:2rem; }
@media(max-width:800px){ .container{grid-template-columns:1fr;} }

.panel { background:var(--card); border:1px solid var(--border); border-radius:8px; padding:1.5rem; }
label { font-weight:600; font-size:0.9rem; display:block; margin-top:0.75rem; }

textarea { width:100%; height:120px; font-family:monospace; font-size:0.85rem; padding:0.5rem; border:1px solid var(--border); border-radius:4px; }

select, button { width:100%; margin-top:1rem; padding:0.75rem; font-weight:600; border-radius:6px; }
button { background:var(--primary); color:white; border:none; cursor:pointer; }
button:hover { opacity:0.9; }

.truck-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:1.5rem; }
.truck-card { border:1px solid var(--border); border-radius:8px; background:var(--card); }
.truck-header { padding:1rem; background:#f1f5f9; border-bottom:1px solid var(--border); }
.stats { display:flex; gap:1rem; font-size:0.9rem; }
.stat span:first-child { font-size:0.7rem; color:#64748b; text-transform:uppercase; display:block; }
.stat span:last-child { font-weight:600; }

.status { display:inline-block; padding:0.4rem 0.8rem; border-radius:99px; font-size:0.8rem; font-weight:600; margin-bottom:1rem; }
.ok { background:#dcfce7; color:#166534; }
.fail { background:#fee2e2; color:#991b1b; }
</style>
</head>

<body>

<h1>Truck Load Optimizer</h1>
<p class="subtitle">Higher TP Count â†’ Lower mÂ³</p>

<div class="container">

<div class="panel">

<label>Transport Numbers (space separated)</label>
<textarea id="tpInput"></textarea>

<label>mÂ³ (space separated)</label>
<textarea id="m3Input"></textarea>

<label>Weight (space separated)</label>
<textarea id="kgInput"></textarea>

<label>Destinations (paste as ONE block â€“ ends with *)</label>
<textarea id="destInput"></textarea>

<label>Number of Trucks</label>
<select id="truckCount">
<option value="2">2 Trucks</option>
<option value="3">3 Trucks</option>
<option value="4">4 Trucks</option>
<option value="5">5 Trucks</option>
</select>

<button onclick="runOptimization()">Calculate Layout</button>
</div>

<div id="outputArea">
<div class="panel" style="text-align:center;color:#94a3b8;">Results will appear here</div>
</div>

</div>

<script>
function collectItems() {
    const tp = tpInput.value.trim().split(/\s+/);
    const m3 = m3Input.value.trim().split(/\s+/);
    const kg = kgInput.value.trim().split(/\s+/);

    // ðŸ”‘ DESTINATION SPLIT LOGIC
    const destRaw = destInput.value.trim();
    const dest = destRaw
        .split('*')
        .map(d => d.trim())
        .filter(d => d.length);

    const len = tp.length;

    if (![m3.length, kg.length, dest.length].every(l => l === len)) {
        alert(
            "Column size mismatch:\n" +
            `TP: ${tp.length}\n` +
            `mÂ³: ${m3.length}\n` +
            `KG: ${kg.length}\n` +
            `Dest: ${dest.length}`
        );
        return [];
    }

    return tp.map((_, i) => ({
        tp: tp[i],
        m3: parseFloat(m3[i].replace(',', '.')),
        kg: parseFloat(kg[i].replace(',', '.')),
        dest: dest[i],
        originalLine: ""
    }));
}

/* ===== OPTIMIZATION LOGIC (UNCHANGED) ===== */

function runOptimization() {
    const items = collectItems();
    if (items.length === 0) return;

    const numTrucks = parseInt(truckCount.value);
    const tpGroups = groupItemsByTP(items);
    const destGroups = groupTPsByDestination(tpGroups);
    const trucks = calculateTrucks(destGroups, numTrucks);
    renderResults(trucks);
}

function groupItemsByTP(items) {
    const map = new Map();
    items.forEach(i => {
        if (!map.has(i.tp))
            map.set(i.tp,{tp:i.tp,dest:i.dest,kg:0,m3:0,tpCount:1,lines:[]});
        const g = map.get(i.tp);
        g.kg+=i.kg; g.m3+=i.m3; g.lines.push(i);
    });
    return [...map.values()];
}

function groupTPsByDestination(tps) {
    const map = new Map();
    tps.forEach(t => {
        if (!map.has(t.dest))
            map.set(t.dest,{dest:t.dest,kg:0,m3:0,tpCount:0,tpList:[]});
        const d = map.get(t.dest);
        d.kg+=t.kg; d.m3+=t.m3; d.tpCount++; d.tpList.push(t);
    });
    return [...map.values()];
}

function calculateTrucks(blocks, n) {
    const trucks = Array.from({length:n},(_,i)=>({id:i+1,kg:0,m3:0,tpCount:0,blocks:[]}));
    blocks.sort((a,b)=>b.m3-a.m3);
    blocks.forEach(b=>{
        trucks.sort((a,b)=>a.m3-b.m3);
        addBlock(trucks[0],b);
    });
    return trucks;
}

function addBlock(t,b){
    t.blocks.push(b);
    t.kg+=b.kg;
    t.m3+=b.m3;
    t.tpCount+=b.tpCount;
}

function renderResults(trucks) {
    const sorted=[...trucks].sort((a,b)=>b.tpCount-a.tpCount);
    let ok=true;
    for(let i=0;i<sorted.length-1;i++)
        if(sorted[i].tpCount>sorted[i+1].tpCount && sorted[i].m3>=sorted[i+1].m3) ok=false;

    let html=`<div class="status ${ok?'ok':'fail'}">
    ${ok?'Rule satisfied':'Rule violated'}
    </div><div class="truck-grid">`;

    trucks.forEach(t=>{
        html+=`
        <div class="truck-card">
        <div class="truck-header">
        <strong>Truck ${t.id}</strong>
        <div class="stats">
        <div class="stat"><span>TP</span><span>${t.tpCount}</span></div>
        <div class="stat"><span>mÂ³</span><span>${t.m3.toFixed(2)}</span></div>
        <div class="stat"><span>KG</span><span>${t.kg.toFixed(0)}</span></div>
        </div></div></div>`;
    });

    outputArea.innerHTML=html+"</div>";
}
</script>

</body>
</html>
