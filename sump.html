<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Truck Load Optimizer</title>

<style>
:root { --primary:#2563eb; --bg:#f8fafc; --card:#fff; --border:#e2e8f0; --text:#1e293b; }
body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); padding: 2rem; max-width: 1200px; margin: 0 auto; }
h1 { font-size: 1.5rem; color: var(--primary); }
.subtitle { font-size: 0.9rem; color: #64748b; margin-bottom: 1.5rem; }

.container { display: grid; grid-template-columns: 350px 1fr; gap: 2rem; }
@media (max-width:800px){ .container{grid-template-columns:1fr;} }

.panel { background: var(--card); padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border); }
label { font-weight: 600; font-size: 0.9rem; margin-bottom: 0.5rem; display:block; }

.control-group { display:flex; gap:1rem; margin-bottom:0.75rem; }
input, select { padding:0.5rem; border:1px solid var(--border); border-radius:4px; width:100%; }

button { background: var(--primary); color:white; border:none; padding:0.75rem; border-radius:6px; font-weight:600; cursor:pointer; width:100%; margin-top:0.5rem; }
button:hover { opacity:0.9; }

.truck-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:1.5rem; }
.truck-card { background:var(--card); border:1px solid var(--border); border-radius:8px; overflow:hidden; }
.truck-header { padding:1rem; background:#f1f5f9; border-bottom:1px solid var(--border); }
.truck-title { font-weight:700; display:flex; justify-content:space-between; }
.stats-row { display:flex; gap:1rem; font-size:0.9rem; }
.stat span:first-child { font-size:0.7rem; color:#64748b; text-transform:uppercase; }
.stat span:last-child { font-weight:600; }

.table-container { max-height:300px; overflow-y:auto; }
table { width:100%; border-collapse:collapse; font-size:0.85rem; }
th, td { padding:8px 12px; border-bottom:1px solid var(--border); }

.status-badge { padding:0.4rem 0.8rem; border-radius:99px; font-size:0.8rem; font-weight:600; margin-bottom:1rem; display:inline-block; }
.status-success { background:#dcfce7; color:#166534; }
.status-fail { background:#fee2e2; color:#991b1b; }
</style>
</head>

<body>

<h1>Truck Load Optimizer</h1>
<p class="subtitle">Higher TP Count → Lower m³</p>

<div class="container">

<div class="panel">
<label>1. Enter Shipment Data</label>

<div class="control-group">
<input id="tpInput" placeholder="TP Number">
<input id="kgInput" placeholder="Weight (kg)" type="number">
</div>

<div class="control-group">
<input id="m3Input" placeholder="m³" type="number" step="0.01">
<input id="destInput" placeholder="Destination">
</div>

<button type="button" onclick="addRow()">Add Entry</button>
<div id="entryCount" style="font-size:0.8rem;color:#64748b;margin-top:0.5rem;"></div>

<hr style="margin:1rem 0">

<label>Number of Trucks</label>
<select id="truckCount">
<option value="2">2 Trucks</option>
<option value="3">3 Trucks</option>
<option value="4">4 Trucks</option>
<option value="5">5 Trucks</option>
</select>

<button onclick="runOptimization()">Calculate Layout</button>
</div>

<div id="outputArea">
<div class="panel" style="text-align:center;color:#94a3b8;">Results will appear here...</div>
</div>

</div>

<script>
let manualEntries = [];

function addRow() {
    const tp = tpInput.value.trim();
    const kg = parseFloat(kgInput.value);
    const m3 = parseFloat(m3Input.value);
    const dest = destInput.value.trim();

    if (!tp || !dest || isNaN(kg) || isNaN(m3)) {
        alert("Please fill all fields correctly.");
        return;
    }

    manualEntries.push({ tp, kg, m3, dest });

    tpInput.value = kgInput.value = m3Input.value = destInput.value = '';
    entryCount.innerText = manualEntries.length + " entries added";
}

/* ===== ORIGINAL LOGIC (UNCHANGED) ===== */

function runOptimization() {
    const numTrucks = parseInt(truckCount.value);
    if (manualEntries.length === 0) return alert("Add entries first");

    const items = manualEntries.map(i => ({
        ...i,
        originalLine: ""
    }));

    const tpGroups = groupItemsByTP(items);
    const destGroups = groupTPsByDestination(tpGroups);
    const result = calculateTrucks(destGroups, numTrucks);
    renderResults(result);
}

function groupItemsByTP(items) {
    const map = new Map();
    items.forEach(i => {
        if (!map.has(i.tp))
            map.set(i.tp, { tp:i.tp, dest:i.dest, kg:0, m3:0, lines:[], tpCount:1 });
        const g = map.get(i.tp);
        g.kg += i.kg; g.m3 += i.m3; g.lines.push(i);
    });
    return [...map.values()];
}

function groupTPsByDestination(tps) {
    const map = new Map();
    tps.forEach(t => {
        if (!map.has(t.dest))
            map.set(t.dest,{dest:t.dest,kg:0,m3:0,tpCount:0,tpList:[]});
        const d = map.get(t.dest);
        d.kg += t.kg; d.m3 += t.m3; d.tpCount++; d.tpList.push(t);
    });
    return [...map.values()];
}

function calculateTrucks(blocks, n) {
    let trucks = Array.from({length:n},(_,i)=>({id:i+1,kg:0,m3:0,tpCount:0,blocks:[]}));
    blocks.sort((a,b)=>b.m3-a.m3);

    blocks.forEach(b=>{
        trucks.sort((a,b)=>a.m3-b.m3);
        addBlock(trucks[0],b);
    });

    return trucks;
}

function addBlock(t,b){ t.blocks.push(b); t.kg+=b.kg; t.m3+=b.m3; t.tpCount+=b.tpCount; }

function renderResults(trucks) {
    let ok = true;
    const sorted = [...trucks].sort((a,b)=>b.tpCount-a.tpCount);
    for(let i=0;i<sorted.length-1;i++)
        if(sorted[i].tpCount>sorted[i+1].tpCount && sorted[i].m3>=sorted[i+1].m3) ok=false;

    let html = `<div class="status-badge ${ok?'status-success':'status-fail'}">
    ${ok?'Rule satisfied':'Rule violation'}</div><div class="truck-grid">`;

    trucks.forEach(t=>{
        html+=`
        <div class="truck-card">
        <div class="truck-header">
        <div class="truck-title">Truck ${t.id}</div>
        <div class="stats-row">
        <div class="stat"><span>TP</span><span>${t.tpCount}</span></div>
        <div class="stat"><span>m³</span><span>${t.m3.toFixed(2)}</span></div>
        <div class="stat"><span>KG</span><span>${t.kg.toFixed(0)}</span></div>
        </div></div></div>`;
    });

    outputArea.innerHTML = html + "</div>";
}
</script>
</body>
</html>
